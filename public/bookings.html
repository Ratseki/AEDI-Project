<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Book Your Session — ProfilePicMultimedia</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="navstyle.css" />
  <style>
    .bk-page { padding: 140px 40px 80px; background: #f4f4f4; min-height: 100vh; color: #0A142D; }
    .bk-container { max-width: 800px; margin: 0 auto; background: rgba(255,255,255,0.95); border-left: 6px solid #CE6826; padding: 30px; border-radius: 8px; box-shadow: 0 6px 30px rgba(0,0,0,0.08);}
    .bk-title { font-size: 28px; font-weight:700; color:#0A142D; margin-bottom: 20px; letter-spacing: 1px;}
    .bk-row { display:flex; gap:16px; flex-wrap:wrap; margin-bottom:14px; }
    .bk-col { flex:1; min-width:200px; display:flex; flex-direction:column; }
    .bk-input, .bk-select { padding:10px; border-radius:6px; border:1px solid #ccc; font-size:14px; }
    .bk-label { font-size:13px; margin-bottom:6px; color:#0A142D; font-weight:600; }
    .bk-required { color: #e03b3b; margin-left:4px; }
    .bk-actions { display:flex; gap:12px; align-items:center; margin-top:10px; }
    .bk-btn { background:#CE6826; color:#fff; border:none; padding:10px 16px; border-radius:6px; cursor:pointer; font-weight:600; }
    .bk-btn.secondary { background:#F9BF5F; color:#0A142D; }
    .bk-summary { background:#F9BF5F20; padding:12px; border-radius:6px; margin-top:10px; }
    .bk-error { border:1px solid #e03b3b; background:#ffecec; color:#a80000; padding:8px; border-radius:6px; margin-top:6px; }
    option[disabled]:hover { cursor: not-allowed; }
    @media (max-width:900px){ .bk-row {flex-direction:column;} .bk-col{min-width: unset;} }
  </style>
</head>
<body>
   <!-- ===== NAVBAR ===== -->
  <header class="navbar">
    <div class="logo">
      <!-- Replace this with your actual logo image -->
      <img src="images/logo_test.png" alt="Profilepic Multimedia Logo" />
    </div>

    <nav class="nav-links">
      <a href="#home" class="active">Home</a>
      <a href="#about">About Us</a>
      <a href="#packages">Package & Booking</a>
      <!--
      <div class="dropdown">
        <button class="dropbtn">Services ▾</button>
        <div class="dropdown-content">
          <a href="service_and_packages.html">Photography Packages</a>
          <a href="#locations-section">Locations</a>
          <a href="#how-it-works">Booking Guide</a>
        </div>
      </div>-->

      <a href="/user/gallery">Gallery</a>
      <a href="#contact">Contact</a>
      
      <div class="account-icon" id="account-nav">
        <!-- This will be updated by JS -->
      </div>

  </header>

  <main class="bk-page">
    <div class="bk-container">
      <h1 class="bk-title">BOOK YOUR SESSION</h1>

      <form id="bkForm" onsubmit="return false;">
        <!-- Basic Info -->
        <div class="bk-row">
          <div class="bk-col">
            <label class="bk-label">First Name <span class="bk-required">*</span></label>
            <input id="firstName" class="bk-input" required />
          </div>
          <div class="bk-col">
            <label class="bk-label">Last Name <span class="bk-required">*</span></label>
            <input id="lastName" class="bk-input" required />
          </div>
        </div>

        <!-- Contact Info -->
        <div class="bk-row">
          <div class="bk-col">
            <label class="bk-label">E-mail <span class="bk-required">*</span></label>
            <input id="email" type="email" class="bk-input" placeholder="myname@example.com" required />
          </div>
          <div class="bk-col">
            <label class="bk-label">Phone Number <span class="bk-required">*</span></label>
            <div style="display:flex;gap:8px;">
              <input id="phoneArea" class="bk-input" placeholder="Area" style="width:90px" required />
              <input id="phoneNumber" class="bk-input" placeholder="Phone number" required />
            </div>
          </div>
        </div>

       
        <div class="bk-row">
          <div class="bk-col" style="flex: 2 1 100%;">
            <label class="bk-label">Street Address <span class="bk-required">*</span></label>
            <input id="address" class="bk-input" required />
          </div>
        </div>

        <!-- Date & Time -->
        <div class="bk-row">
          <div class="bk-col">
            <label class="bk-label">Select Appointment Date <span class="bk-required">*</span></label>
            <input id="date" class="bk-input" type="date" required />
          </div>

          <div class="bk-col">
            <label class="bk-label">Select Time <span class="bk-required">*</span></label>
            <select id="time" class="bk-select" required>
              <option value="">-- select a time --</option>
              <option>08:00</option>
              <option>09:00</option>
              <option>10:00</option>
              <option>11:00</option>
              <option>12:00</option>
              <option>13:00</option>
              <option>14:00</option>
              <option>15:00</option>
              <option>16:00</option>
              <option>17:00</option>
            </select>
            <div style="font-size:13px;margin-top:6px;">Timezone: <span id="detectedTz"></span></div>
          </div>
        </div>

        <!-- Location & Package -->
        <div class="bk-row">
          <div class="bk-col">
            <label class="bk-label">Session Location <span class="bk-required">*</span></label>
            <select id="location" class="bk-select" required>
              <option value="">Please select</option>
              <option value="Paoay, Ilocos Norte">Paoay, Ilocos Norte</option>
              <option value="Daraga, Albay" disabled title="Coming soon">Daraga, Albay (Coming Soon)</option>
              <option value="Carmen, Bohol" disabled title="Coming soon">Carmen, Bohol (Coming Soon)</option>
              <option value="La Union" disabled title="Coming soon">La Union (Coming Soon)</option>
            </select>
          </div>

          <div class="bk-col">
            <label class="bk-label">Package <span class="bk-required">*</span></label>
            <select id="package" class="bk-select" required>
              <option value="">Please select</option>
              <option value="1" data-price="40">Pro — ₱40</option>
              <option value="2" data-price="25">Plus — ₱25</option>
              <option value="3" data-price="10">Standard — ₱10</option>
            </select>
          </div>
        </div>

        <div class="bk-col">
        <label class="bk-label">Payment Method <span class="bk-required">*</span></label>
        <select id="paymentMethod" class="bk-select" required>
          <option value="">Please select</option>
          <option value="gcash">GCash</option>
          <option value="card">Credit/Debit Card</option>
          <option value="maya" disabled title="Coming soon">Maya (Coming Soon)</option>
        </select>
      </div>



        <!-- Agreement -->
        <div style="margin-top:12px;">
          <label class="bk-label">Agreement <span class="bk-required">*</span></label>
          <div style="background:#fff; padding:12px; border-radius:6px; border:1px solid #eee;">
            <p style="font-size:13px;">By submitting you agree to our terms and consent to model release and copyright terms.</p>
          </div>
          <label style="display:block; margin-top:8px;"><input id="agree" type="checkbox" /> I agree</label>
        </div>

        <div id="bkError" class="bk-error" style="display:none;"></div>
        <div class="bk-summary" id="bkSummary" style="display:none;"></div>

        <div class="bk-actions">
          <button id="bkSubmit" class="bk-btn">Continue to Payment</button>
          <button id="bkClear" class="bk-btn secondary" type="button">Reset</button>
        </div>
      </form>
    </div>
  </main>

   <!-- ===== FOOTER SECTION ===== -->
<footer>
    <div class="footer-container">
        <!-- LEFT: Logo and Contact -->
        <div class="footer-logo-section">
            <div class="footer-logo">
                <img src="images/logo_wbg.png" alt="ProfilePic Multimedia">
            </div>
            <div class="footer-contact">
                <p>0976 004 2741</p>
                <p>profilepicmultimedia@gmail.com</p>
            </div>
        </div>

        <!-- Navigation -->
        <div class="footer-column">
            <h3>Discover</h3>
            <ul>
                <li><a href="#">About Us</a></li>
                <li><a href="#">Partner Locations</a></li>
                <li><a href="#">Packages</a></li>
                <li><a href="#">Gallery</a></li>
                <li><a href="#">Testimonials</a></li>
            </ul>
        </div>

        <div class="footer-column">
            <h3>Support</h3>
            <ul>
                <li><a href="#">How It Works</a></li>
                <li><a href="#">Booking Guide</a></li>
                <li><a href="#">My Gallery</a></li>
                <li><a href="#">Edit My Account</a></li>
                <li><a href="#">Payment & Refund Policy</a></li>
                <li><a href="#">Contact</a></li>
            </ul>
        </div>

        <!-- Legal -->
        <div class="footer-column">
            <h3>Legal</h3>
            <ul>
                <li><a href="#">Terms & Conditions</a></li>
                <li><a href="#">Privacy Policy</a></li>
                <li><a href="#">FAQs</a></li>
            </ul>
        </div>

        <!-- Follow Us -->
        <div class="footer-column">
            <h3>Follow us</h3>
            <ul>
            <a href="#"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640"><!--!Font Awesome Free v7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path d="M240 363.3L240 576L356 576L356 363.3L442.5 363.3L460.5 265.5L356 265.5L356 230.9C356 179.2 376.3 159.4 428.7 159.4C445 159.4 458.1 159.8 465.7 160.6L465.7 71.9C451.4 68 416.4 64 396.2 64C289.3 64 240 114.5 240 223.4L240 265.5L174 265.5L174 363.3L240 363.3z"/></svg></a>
             <a href="#"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640"><!--!Font Awesome Free v7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path d="M544.5 273.9C500.5 274 457.5 260.3 421.7 234.7L421.7 413.4C421.7 446.5 411.6 478.8 392.7 506C373.8 533.2 347.1 554 316.1 565.6C285.1 577.2 251.3 579.1 219.2 570.9C187.1 562.7 158.3 545 136.5 520.1C114.7 495.2 101.2 464.1 97.5 431.2C93.8 398.3 100.4 365.1 116.1 336C131.8 306.9 156.1 283.3 185.7 268.3C215.3 253.3 248.6 247.8 281.4 252.3L281.4 342.2C266.4 337.5 250.3 337.6 235.4 342.6C220.5 347.6 207.5 357.2 198.4 369.9C189.3 382.6 184.4 398 184.5 413.8C184.6 429.6 189.7 444.8 199 457.5C208.3 470.2 221.4 479.6 236.4 484.4C251.4 489.2 267.5 489.2 282.4 484.3C297.3 479.4 310.4 469.9 319.6 457.2C328.8 444.5 333.8 429.1 333.8 413.4L333.8 64L421.8 64C421.7 71.4 422.4 78.9 423.7 86.2C426.8 102.5 433.1 118.1 442.4 131.9C451.7 145.7 463.7 157.5 477.6 166.5C497.5 179.6 520.8 186.6 544.6 186.6L544.6 274z"/></svg></a>
            </ul>
        </div>
        
    </div>

    <div class="footer-bottom">
        <p class="copyright">Copyright © ProfilePicMultimedia 2025</p>
        <a href="#" class="back-to-top">Back to top</a>
    </div>
</footer>

  <script>
  // Detect timezone
  document.getElementById('detectedTz').textContent = Intl.DateTimeFormat().resolvedOptions().timeZone || 'Local';

  // Disable past dates
  const today = new Date().toISOString().split("T")[0];
  document.getElementById("date").setAttribute("min", today);

  // === Currency conversion rate (USD → PHP) ===
  const USD_TO_PHP = 58;

  // Show converted price automatically
  const pkgSelect = document.getElementById("package");
  pkgSelect.addEventListener("change", () => {
    const usd = parseFloat(pkgSelect.selectedOptions[0].dataset.price || 0);
    if (usd > 0) {
      const php = usd * USD_TO_PHP;
      alert(`Selected package price: ₱${php.toLocaleString()} (≈ $${usd})`);
    }
  });

  function showError(msg){
    const el = document.getElementById('bkError');
    el.style.display='block';
    el.textContent=msg;
  }
  function clearError(){
    const el = document.getElementById('bkError');
    el.style.display='none';
    el.textContent='';
  }

  document.getElementById('bkClear').addEventListener('click', ()=>{
    document.getElementById('bkForm').reset();
    clearError();
    document.getElementById('bkSummary').style.display='none';
  });

  document.getElementById('bkSubmit').addEventListener('click', async ()=>{
    clearError();

    const firstName = document.getElementById("firstName").value.trim();
    const lastName = document.getElementById("lastName").value.trim();
    const email = document.getElementById("email").value.trim();
    const phoneArea = document.getElementById("phoneArea").value.trim();
    const phoneNumber = document.getElementById("phoneNumber").value.trim();
    const date = document.getElementById("date").value;
    const time = document.getElementById("time").value;
    const location = document.getElementById("location").value;
    const pkgOption = pkgSelect.selectedOptions[0];
    const service_id = pkgOption.value;
    const usd = parseFloat(pkgOption.dataset.price || 0);
    const php = usd * USD_TO_PHP;
    const pkg = pkgOption.text;
    
    const method = document.getElementById("paymentMethod").value;
    if (!method) {
      showError("Please select a payment method.");
      return;
    }

    const agree = document.getElementById("agree").checked;

    if(!firstName || !lastName || !email || !phoneNumber || !date || !time || !location || !pkg || !agree){
      showError("Please fill all required fields and accept the agreement.");
      return;
    }

    const token = localStorage.getItem("token");
    if (!token) {
      alert("Please log in to continue.");
      window.location.href = "/login.html";
      return;
    }

    const payload = {
      first_name: firstName,
      last_name: lastName,
      email,
      phone_area: phoneArea,
      phone_number: phoneNumber,
      date,
      time,
      location,
      package_name: pkg,
      service_id,
      amount: php
    };

    try {
      const res = await fetch("/api/bookings", {
        method:"POST",
        headers:{
          "Content-Type":"application/json",
          "Authorization":"Bearer " + token
        },
        body: JSON.stringify(payload)
      });

      const data = await res.json();
      if (!res.ok) {
        showError(data.message || "Server error");
        return;
      }

      const s = document.getElementById("bkSummary");
      s.style.display="block";
      s.innerHTML = `
        <strong>Booking created ✅</strong><br>
        Booking ID: ${data.booking_id}<br>
        Package: ${payload.package_name}<br>
        Total Amount: ₱${php.toLocaleString()}<br>
        Date: ${payload.date} ${payload.time}<br>
        <div style="margin-top:8px;">
          <button class="bk-btn" onclick="proceedToPayment(${data.booking_id}, ${php}, '${method}')">Proceed to Payment</button>
        </div>
      `;
    } catch (err){
      console.error(err);
      showError("Network error.");
    }
  });

  // === Payment redirect ===
 async function proceedToPayment(bookingId, amount, method) {
  const token = localStorage.getItem("token");
  try {
    const res = await fetch("/api/payments/create-checkout-session", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": "Bearer " + token
      },
      body: JSON.stringify({
        amount,
        booking_id: bookingId,
        method
      })
    });

    const data = await res.json();
    if (!res.ok) {
      alert(`⚠️ Payment failed: ${data.message}`);
      return;
    }

    window.location.href = data.checkout_url;
  } catch (err) {
    console.error("❌ Payment error:", err);
    alert("Server error while creating checkout session.");
  }
}

</script>

</body>
</html>
